{
    "info": {
        "name": "TechStore API - Full Test Suite v2",
        "_postman_id": "techstore-full-test-v2",
        "description": "Complete test suite for TechStore PRM393 Backend (24 endpoints + security tests).\n\nRun order: Auth → Categories → Products → Orders → Order Status → Cancel → Reports → Security Edge Cases\n\nTokens are auto-saved via test scripts.",
        "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
    },
    "variable": [
        {
            "key": "baseUrl",
            "value": "http://localhost:5217"
        },
        {
            "key": "adminToken",
            "value": ""
        },
        {
            "key": "customerToken",
            "value": ""
        },
        {
            "key": "categoryId",
            "value": ""
        },
        {
            "key": "categoryId2",
            "value": ""
        },
        {
            "key": "productId",
            "value": ""
        },
        {
            "key": "productId2",
            "value": ""
        },
        {
            "key": "orderId",
            "value": ""
        },
        {
            "key": "orderId2",
            "value": ""
        },
        {
            "key": "customerId",
            "value": ""
        }
    ],
    "item": [
        {
            "name": "1. Auth",
            "item": [
                {
                    "name": "1.1 Register Admin",
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"username\": \"admin\",\n  \"email\": \"admin@techstore.com\",\n  \"password\": \"admin123\",\n  \"fullName\": \"Admin TechStore\"\n}"
                        },
                        "url": {
                            "raw": "{{baseUrl}}/api/auth/register",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "auth",
                                "register"
                            ]
                        }
                    },
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Register Admin - 200 or 400 (exists)', () => {",
                                    "  pm.expect(pm.response.code).to.be.oneOf([200, 400]);",
                                    "});"
                                ]
                            }
                        }
                    ]
                },
                {
                    "name": "1.2 Register Customer",
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"username\": \"Snuggie\",\n  \"email\": \"tronghieu848@gmail.com\",\n  \"password\": \"123456\",\n  \"fullName\": \"Lê Trọng Hiếu\",\n  \"phone\": \"0986515253\"\n}"
                        },
                        "url": {
                            "raw": "{{baseUrl}}/api/auth/register",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "auth",
                                "register"
                            ]
                        }
                    },
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Register Customer - 200 or 400', () => {",
                                    "  pm.expect(pm.response.code).to.be.oneOf([200, 400]);",
                                    "});",
                                    "if (pm.response.code === 200) {",
                                    "  var json = pm.response.json();",
                                    "  pm.collectionVariables.set('customerToken', json.data.token);",
                                    "  pm.collectionVariables.set('customerId', json.data.id);",
                                    "}"
                                ]
                            }
                        }
                    ]
                },
                {
                    "name": "1.3 Login Admin",
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"username\": \"admin\",\n  \"password\": \"admin123\"\n}"
                        },
                        "url": {
                            "raw": "{{baseUrl}}/api/auth/login",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "auth",
                                "login"
                            ]
                        }
                    },
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Login Admin - 200', () => pm.response.to.have.status(200));",
                                    "var json = pm.response.json();",
                                    "pm.test('success is true', () => pm.expect(json.success).to.be.true);",
                                    "pm.test('Has JWT', () => pm.expect(json.data.token).to.be.a('string'));",
                                    "pm.test('Role=Admin', () => pm.expect(json.data.role).to.eql('Admin'));",
                                    "pm.collectionVariables.set('adminToken', json.data.token);"
                                ]
                            }
                        }
                    ]
                },
                {
                    "name": "1.4 Login Customer",
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"username\": \"Snuggie\",\n  \"password\": \"123456\"\n}"
                        },
                        "url": {
                            "raw": "{{baseUrl}}/api/auth/login",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "auth",
                                "login"
                            ]
                        }
                    },
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Login Customer - 200', () => pm.response.to.have.status(200));",
                                    "var json = pm.response.json();",
                                    "pm.test('Role=Customer', () => pm.expect(json.data.role).to.eql('Customer'));",
                                    "pm.collectionVariables.set('customerToken', json.data.token);",
                                    "pm.collectionVariables.set('customerId', json.data.id);"
                                ]
                            }
                        }
                    ]
                },
                {
                    "name": "1.5 Login Wrong Password (401)",
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"username\": \"admin\",\n  \"password\": \"wrong\"\n}"
                        },
                        "url": {
                            "raw": "{{baseUrl}}/api/auth/login",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "auth",
                                "login"
                            ]
                        }
                    },
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Wrong password - 401', () => pm.response.to.have.status(401));",
                                    "pm.test('success=false', () => pm.expect(pm.response.json().success).to.be.false);"
                                ]
                            }
                        }
                    ]
                }
            ]
        },
        {
            "name": "2. Categories",
            "item": [
                {
                    "name": "2.1 Create Category - Laptop",
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            },
                            {
                                "key": "Authorization",
                                "value": "Bearer {{adminToken}}"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"name\": \"Laptop\",\n  \"description\": \"Máy tính xách tay các loại\"\n}"
                        },
                        "url": {
                            "raw": "{{baseUrl}}/api/categories",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "categories"
                            ]
                        }
                    },
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Create Laptop - 201 or 400', () => pm.expect(pm.response.code).to.be.oneOf([201, 400]));",
                                    "var json = pm.response.json();",
                                    "if (json.success && json.data) pm.collectionVariables.set('categoryId', json.data.id);"
                                ]
                            }
                        }
                    ]
                },
                {
                    "name": "2.2 Create Category - Smartphone",
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            },
                            {
                                "key": "Authorization",
                                "value": "Bearer {{adminToken}}"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"name\": \"Smartphone\",\n  \"description\": \"Điện thoại thông minh\"\n}"
                        },
                        "url": {
                            "raw": "{{baseUrl}}/api/categories",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "categories"
                            ]
                        }
                    },
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Create Smartphone - 201 or 400', () => pm.expect(pm.response.code).to.be.oneOf([201, 400]));",
                                    "var json = pm.response.json();",
                                    "if (json.success && json.data) pm.collectionVariables.set('categoryId2', json.data.id);"
                                ]
                            }
                        }
                    ]
                },
                {
                    "name": "2.3 Get All Categories",
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{baseUrl}}/api/categories",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "categories"
                            ]
                        }
                    },
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Get All - 200', () => pm.response.to.have.status(200));",
                                    "var json = pm.response.json();",
                                    "pm.test('Is array', () => pm.expect(json.data).to.be.an('array'));",
                                    "pm.test('Has productCount', () => pm.expect(json.data[0]).to.have.property('productCount'));",
                                    "if (json.data.length > 0) pm.collectionVariables.set('categoryId', json.data[0].id);",
                                    "if (json.data.length > 1) pm.collectionVariables.set('categoryId2', json.data[1].id);"
                                ]
                            }
                        }
                    ]
                },
                {
                    "name": "2.4 Get Category By ID",
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{baseUrl}}/api/categories/{{categoryId}}",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "categories",
                                "{{categoryId}}"
                            ]
                        }
                    },
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Get By ID - 200', () => pm.response.to.have.status(200));",
                                    "pm.test('Has name', () => pm.expect(pm.response.json().data.name).to.be.a('string'));"
                                ]
                            }
                        }
                    ]
                },
                {
                    "name": "2.5 Update Category",
                    "request": {
                        "method": "PUT",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            },
                            {
                                "key": "Authorization",
                                "value": "Bearer {{adminToken}}"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"name\": \"Laptop\",\n  \"description\": \"Laptop gaming và văn phòng\"\n}"
                        },
                        "url": {
                            "raw": "{{baseUrl}}/api/categories/{{categoryId}}",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "categories",
                                "{{categoryId}}"
                            ]
                        }
                    },
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Update - 200', () => pm.response.to.have.status(200));",
                                    "pm.test('Updated description', () => pm.expect(pm.response.json().data.description).to.include('gaming'));"
                                ]
                            }
                        }
                    ]
                },
                {
                    "name": "2.6 Get Non-Existent Category (404)",
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{baseUrl}}/api/categories/99999",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "categories",
                                "99999"
                            ]
                        }
                    },
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Not Found - 404', () => pm.response.to.have.status(404));",
                                    "pm.test('success=false', () => pm.expect(pm.response.json().success).to.be.false);"
                                ]
                            }
                        }
                    ]
                }
            ]
        },
        {
            "name": "3. Products",
            "item": [
                {
                    "name": "3.1 Create - MacBook Pro",
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            },
                            {
                                "key": "Authorization",
                                "value": "Bearer {{adminToken}}"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"name\": \"MacBook Pro 14 M3 Pro\",\n  \"description\": \"MacBook Pro 14 inch chip M3 Pro, 18GB RAM, 512GB SSD\",\n  \"price\": 49990000,\n  \"stockQuantity\": 25,\n  \"categoryId\": {{categoryId}},\n  \"imageUrl\": \"https://store.storeimages.cdn-apple.com/macbook-pro-14.jpg\",\n  \"specs\": [\n    { \"specKey\": \"CPU\", \"specValue\": \"Apple M3 Pro\" },\n    { \"specKey\": \"RAM\", \"specValue\": \"18GB\" },\n    { \"specKey\": \"Storage\", \"specValue\": \"512GB SSD\" },\n    { \"specKey\": \"Display\", \"specValue\": \"14.2 inch Liquid Retina XDR\" }\n  ]\n}"
                        },
                        "url": {
                            "raw": "{{baseUrl}}/api/products",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "products"
                            ]
                        }
                    },
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Create MacBook - 201', () => pm.response.to.have.status(201));",
                                    "var json = pm.response.json();",
                                    "pm.test('Has specs', () => pm.expect(json.data.specs.length).to.be.greaterThan(0));",
                                    "pm.collectionVariables.set('productId', json.data.id);"
                                ]
                            }
                        }
                    ]
                },
                {
                    "name": "3.2 Create - iPhone 16",
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            },
                            {
                                "key": "Authorization",
                                "value": "Bearer {{adminToken}}"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"name\": \"iPhone 16 Pro Max 256GB\",\n  \"description\": \"iPhone 16 Pro Max Titan Sa Mạc\",\n  \"price\": 34990000,\n  \"stockQuantity\": 50,\n  \"categoryId\": {{categoryId}},\n  \"imageUrl\": \"https://store.storeimages.cdn-apple.com/iphone-16.jpg\",\n  \"specs\": [\n    { \"specKey\": \"CPU\", \"specValue\": \"A18 Pro\" },\n    { \"specKey\": \"RAM\", \"specValue\": \"8GB\" },\n    { \"specKey\": \"Storage\", \"specValue\": \"256GB\" }\n  ]\n}"
                        },
                        "url": {
                            "raw": "{{baseUrl}}/api/products",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "products"
                            ]
                        }
                    },
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Create iPhone - 201', () => pm.response.to.have.status(201));",
                                    "pm.collectionVariables.set('productId2', pm.response.json().data.id);"
                                ]
                            }
                        }
                    ]
                },
                {
                    "name": "3.3 Get Products (default page)",
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{baseUrl}}/api/products",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "products"
                            ]
                        }
                    },
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Get Products - 200', () => pm.response.to.have.status(200));",
                                    "var d = pm.response.json().data;",
                                    "pm.test('Has items', () => pm.expect(d.items).to.be.an('array'));",
                                    "pm.test('Has totalCount', () => pm.expect(d.totalCount).to.be.a('number'));",
                                    "pm.test('Has pagination', () => pm.expect(d.page).to.eql(1));"
                                ]
                            }
                        }
                    ]
                },
                {
                    "name": "3.4 Search Products - MacBook",
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{baseUrl}}/api/products?search=MacBook&sortBy=price",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "products"
                            ],
                            "query": [
                                {
                                    "key": "search",
                                    "value": "MacBook"
                                },
                                {
                                    "key": "sortBy",
                                    "value": "price"
                                }
                            ]
                        }
                    },
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Search - 200', () => pm.response.to.have.status(200));",
                                    "pm.test('Found MacBook', () => {",
                                    "  var items = pm.response.json().data.items;",
                                    "  pm.expect(items.length).to.be.greaterThan(0);",
                                    "  pm.expect(items[0].name).to.include('MacBook');",
                                    "});"
                                ]
                            }
                        }
                    ]
                },
                {
                    "name": "3.5 Filter by Price Range",
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{baseUrl}}/api/products?minPrice=30000000&maxPrice=40000000",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "products"
                            ],
                            "query": [
                                {
                                    "key": "minPrice",
                                    "value": "30000000"
                                },
                                {
                                    "key": "maxPrice",
                                    "value": "40000000"
                                }
                            ]
                        }
                    },
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Price filter - 200', () => pm.response.to.have.status(200));",
                                    "pm.test('In range', () => {",
                                    "  pm.response.json().data.items.forEach(p => pm.expect(p.price).to.be.within(30000000, 40000000));",
                                    "});"
                                ]
                            }
                        }
                    ]
                },
                {
                    "name": "3.6 Get Product Detail",
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{baseUrl}}/api/products/{{productId}}",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "products",
                                "{{productId}}"
                            ]
                        }
                    },
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Detail - 200', () => pm.response.to.have.status(200));",
                                    "var d = pm.response.json().data;",
                                    "pm.test('Has specs', () => pm.expect(d.specs).to.be.an('array'));",
                                    "pm.test('Has categoryName', () => pm.expect(d.categoryName).to.be.a('string'));"
                                ]
                            }
                        }
                    ]
                },
                {
                    "name": "3.7 Update Product",
                    "request": {
                        "method": "PUT",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            },
                            {
                                "key": "Authorization",
                                "value": "Bearer {{adminToken}}"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"name\": \"MacBook Pro 14 M3 Pro\",\n  \"description\": \"MacBook Pro 14 inch - UPDATED\",\n  \"price\": 47990000,\n  \"stockQuantity\": 20,\n  \"categoryId\": {{categoryId}},\n  \"imageUrl\": \"https://store.storeimages.cdn-apple.com/macbook-pro-14.jpg\",\n  \"specs\": [\n    { \"specKey\": \"CPU\", \"specValue\": \"Apple M3 Pro\" },\n    { \"specKey\": \"RAM\", \"specValue\": \"18GB\" },\n    { \"specKey\": \"Storage\", \"specValue\": \"512GB SSD\" },\n    { \"specKey\": \"Display\", \"specValue\": \"14.2 inch\" },\n    { \"specKey\": \"Battery\", \"specValue\": \"70Wh\" }\n  ]\n}"
                        },
                        "url": {
                            "raw": "{{baseUrl}}/api/products/{{productId}}",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "products",
                                "{{productId}}"
                            ]
                        }
                    },
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Update - 200', () => pm.response.to.have.status(200));",
                                    "pm.test('Price=47990000', () => pm.expect(pm.response.json().data.price).to.eql(47990000));",
                                    "pm.test('5 specs', () => pm.expect(pm.response.json().data.specs.length).to.eql(5));"
                                ]
                            }
                        }
                    ]
                },
                {
                    "name": "3.8 Create Without Auth (401)",
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"name\": \"Test\",\n  \"price\": 100,\n  \"categoryId\": 1\n}"
                        },
                        "url": {
                            "raw": "{{baseUrl}}/api/products",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "products"
                            ]
                        }
                    },
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('No Auth - 401', () => pm.response.to.have.status(401));"
                                ]
                            }
                        }
                    ]
                },
                {
                    "name": "3.9 Create As Customer (403)",
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            },
                            {
                                "key": "Authorization",
                                "value": "Bearer {{customerToken}}"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"name\": \"Test\",\n  \"price\": 100,\n  \"categoryId\": 1\n}"
                        },
                        "url": {
                            "raw": "{{baseUrl}}/api/products",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "products"
                            ]
                        }
                    },
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Customer forbidden - 403', () => pm.response.to.have.status(403));"
                                ]
                            }
                        }
                    ]
                }
            ]
        },
        {
            "name": "4. Orders (Customer)",
            "item": [
                {
                    "name": "4.1 Place Order",
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            },
                            {
                                "key": "Authorization",
                                "value": "Bearer {{customerToken}}"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"items\": [\n    { \"productId\": {{productId}}, \"quantity\": 2 }\n  ],\n  \"paymentMethod\": \"COD\",\n  \"shippingAddress\": \"123 Nguyen Trai, Q5, TP.HCM\"\n}"
                        },
                        "url": {
                            "raw": "{{baseUrl}}/api/orders",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "orders"
                            ]
                        }
                    },
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Place Order - 201', () => pm.response.to.have.status(201));",
                                    "var json = pm.response.json();",
                                    "pm.test('Status=Pending', () => pm.expect(json.data.status).to.eql('Pending'));",
                                    "pm.test('Has items', () => pm.expect(json.data.items.length).to.be.greaterThan(0));",
                                    "pm.test('TotalAmount > 0', () => pm.expect(json.data.totalAmount).to.be.greaterThan(0));",
                                    "pm.collectionVariables.set('orderId', json.data.id);"
                                ]
                            }
                        }
                    ]
                },
                {
                    "name": "4.2 Verify Stock Deducted",
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{baseUrl}}/api/products/{{productId}}",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "products",
                                "{{productId}}"
                            ]
                        }
                    },
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Stock deducted - 200', () => pm.response.to.have.status(200));",
                                    "pm.test('Stock < 20', () => pm.expect(pm.response.json().data.stockQuantity).to.be.lessThan(20));"
                                ]
                            }
                        }
                    ]
                },
                {
                    "name": "4.3 Place Order - Duplicate Items Merge",
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            },
                            {
                                "key": "Authorization",
                                "value": "Bearer {{customerToken}}"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"items\": [\n    { \"productId\": {{productId2}}, \"quantity\": 1 },\n    { \"productId\": {{productId2}}, \"quantity\": 2 }\n  ],\n  \"shippingAddress\": \"456 Le Loi, Q1, TP.HCM\"\n}"
                        },
                        "url": {
                            "raw": "{{baseUrl}}/api/orders",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "orders"
                            ]
                        }
                    },
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Duplicate merge - 201', () => pm.response.to.have.status(201));",
                                    "var json = pm.response.json();",
                                    "pm.test('Items merged to 1', () => pm.expect(json.data.items.length).to.eql(1));",
                                    "pm.test('Quantity = 3', () => pm.expect(json.data.items[0].quantity).to.eql(3));",
                                    "pm.collectionVariables.set('orderId2', json.data.id);"
                                ]
                            }
                        }
                    ]
                },
                {
                    "name": "4.4 Insufficient Stock (400)",
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            },
                            {
                                "key": "Authorization",
                                "value": "Bearer {{customerToken}}"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"items\": [{ \"productId\": {{productId}}, \"quantity\": 99999 }],\n  \"shippingAddress\": \"Test Address\"\n}"
                        },
                        "url": {
                            "raw": "{{baseUrl}}/api/orders",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "orders"
                            ]
                        }
                    },
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Insufficient stock - 400', () => pm.response.to.have.status(400));",
                                    "pm.test('Error msg', () => pm.expect(pm.response.json().message).to.include('Insufficient'));"
                                ]
                            }
                        }
                    ]
                },
                {
                    "name": "4.5 Missing ShippingAddress (400)",
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            },
                            {
                                "key": "Authorization",
                                "value": "Bearer {{customerToken}}"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"items\": [{ \"productId\": {{productId}}, \"quantity\": 1 }]\n}"
                        },
                        "url": {
                            "raw": "{{baseUrl}}/api/orders",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "orders"
                            ]
                        }
                    },
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Missing address - 400', () => pm.response.to.have.status(400));"
                                ]
                            }
                        }
                    ]
                },
                {
                    "name": "4.6 My Orders (Paginated)",
                    "request": {
                        "method": "GET",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{customerToken}}"
                            }
                        ],
                        "url": {
                            "raw": "{{baseUrl}}/api/orders/my-orders?page=1&pageSize=5",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "orders",
                                "my-orders"
                            ],
                            "query": [
                                {
                                    "key": "page",
                                    "value": "1"
                                },
                                {
                                    "key": "pageSize",
                                    "value": "5"
                                }
                            ]
                        }
                    },
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('My Orders - 200', () => pm.response.to.have.status(200));",
                                    "var d = pm.response.json().data;",
                                    "pm.test('Has items', () => pm.expect(d.items).to.be.an('array'));",
                                    "pm.test('Has totalCount', () => pm.expect(d.totalCount).to.be.a('number'));",
                                    "pm.test('Has page', () => pm.expect(d.page).to.eql(1));"
                                ]
                            }
                        }
                    ]
                },
                {
                    "name": "4.7 Order Detail",
                    "request": {
                        "method": "GET",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{customerToken}}"
                            }
                        ],
                        "url": {
                            "raw": "{{baseUrl}}/api/orders/{{orderId}}",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "orders",
                                "{{orderId}}"
                            ]
                        }
                    },
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Order Detail - 200', () => pm.response.to.have.status(200));",
                                    "pm.test('Has items', () => pm.expect(pm.response.json().data.items).to.be.an('array'));",
                                    "pm.test('Has shippingAddress', () => pm.expect(pm.response.json().data.shippingAddress).to.be.a('string'));"
                                ]
                            }
                        }
                    ]
                },
                {
                    "name": "4.8 No Auth Place Order (401)",
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"items\": [{ \"productId\": 1, \"quantity\": 1 }],\n  \"shippingAddress\": \"Test\"\n}"
                        },
                        "url": {
                            "raw": "{{baseUrl}}/api/orders",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "orders"
                            ]
                        }
                    },
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('No Auth - 401', () => pm.response.to.have.status(401));"
                                ]
                            }
                        }
                    ]
                },
                {
                    "name": "4.9 Mock Pay Order",
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            },
                            {
                                "key": "Authorization",
                                "value": "Bearer {{customerToken}}"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"orderId\": {{orderId}}\n}"
                        },
                        "url": {
                            "raw": "{{baseUrl}}/api/orders/pay",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "orders",
                                "pay"
                            ]
                        }
                    },
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Mock Pay - 200', () => pm.response.to.have.status(200));",
                                    "var json = pm.response.json();",
                                    "pm.test('success is true', () => pm.expect(json.success).to.be.true);",
                                    "pm.test('Message=Success', () => pm.expect(json.message).to.eql('Success'));",
                                    "pm.test('Status=Paid', () => pm.expect(json.data.status).to.eql('Paid'));"
                                ]
                            }
                        }
                    ]
                }
            ]
        },
        {
            "name": "5. Order Status (Admin)",
            "item": [
                {
                    "name": "5.1 Get All Orders (Admin, Paginated)",
                    "request": {
                        "method": "GET",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{adminToken}}"
                            }
                        ],
                        "url": {
                            "raw": "{{baseUrl}}/api/orders?page=1&pageSize=10",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "orders"
                            ],
                            "query": [
                                {
                                    "key": "page",
                                    "value": "1"
                                },
                                {
                                    "key": "pageSize",
                                    "value": "10"
                                }
                            ]
                        }
                    },
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('All Orders - 200', () => pm.response.to.have.status(200));",
                                    "pm.test('Is paginated', () => pm.expect(pm.response.json().data.totalCount).to.be.a('number'));"
                                ]
                            }
                        }
                    ]
                },
                {
                    "name": "5.2 Pending → Confirmed",
                    "request": {
                        "method": "PUT",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            },
                            {
                                "key": "Authorization",
                                "value": "Bearer {{adminToken}}"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{ \"status\": \"Confirmed\" }"
                        },
                        "url": {
                            "raw": "{{baseUrl}}/api/orders/{{orderId}}/status",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "orders",
                                "{{orderId}}",
                                "status"
                            ]
                        }
                    },
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Confirmed - 200', () => pm.response.to.have.status(200));",
                                    "pm.test('Status=Confirmed', () => pm.expect(pm.response.json().data.status).to.eql('Confirmed'));"
                                ]
                            }
                        }
                    ]
                },
                {
                    "name": "5.3 Confirmed → Shipped",
                    "request": {
                        "method": "PUT",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            },
                            {
                                "key": "Authorization",
                                "value": "Bearer {{adminToken}}"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{ \"status\": \"Shipped\" }"
                        },
                        "url": {
                            "raw": "{{baseUrl}}/api/orders/{{orderId}}/status",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "orders",
                                "{{orderId}}",
                                "status"
                            ]
                        }
                    },
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Shipped - 200', () => pm.response.to.have.status(200));",
                                    "pm.test('Status=Shipped', () => pm.expect(pm.response.json().data.status).to.eql('Shipped'));"
                                ]
                            }
                        }
                    ]
                },
                {
                    "name": "5.4 Shipped → Delivered",
                    "request": {
                        "method": "PUT",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            },
                            {
                                "key": "Authorization",
                                "value": "Bearer {{adminToken}}"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{ \"status\": \"Delivered\" }"
                        },
                        "url": {
                            "raw": "{{baseUrl}}/api/orders/{{orderId}}/status",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "orders",
                                "{{orderId}}",
                                "status"
                            ]
                        }
                    },
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Delivered - 200', () => pm.response.to.have.status(200));",
                                    "pm.test('Status=Delivered', () => pm.expect(pm.response.json().data.status).to.eql('Delivered'));"
                                ]
                            }
                        }
                    ]
                },
                {
                    "name": "5.5 Invalid Transition (400)",
                    "request": {
                        "method": "PUT",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            },
                            {
                                "key": "Authorization",
                                "value": "Bearer {{adminToken}}"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{ \"status\": \"Pending\" }"
                        },
                        "url": {
                            "raw": "{{baseUrl}}/api/orders/{{orderId}}/status",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "orders",
                                "{{orderId}}",
                                "status"
                            ]
                        }
                    },
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Invalid transition - 400', () => pm.response.to.have.status(400));",
                                    "pm.test('Error msg', () => pm.expect(pm.response.json().message).to.include('Cannot change'));"
                                ]
                            }
                        }
                    ]
                }
            ]
        },
        {
            "name": "6. Customer Cancel Order",
            "item": [
                {
                    "name": "6.1 Cancel Pending Order (Customer)",
                    "request": {
                        "method": "PUT",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{customerToken}}"
                            }
                        ],
                        "url": {
                            "raw": "{{baseUrl}}/api/orders/{{orderId2}}/cancel",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "orders",
                                "{{orderId2}}",
                                "cancel"
                            ]
                        }
                    },
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Cancel Pending - 200', () => pm.response.to.have.status(200));",
                                    "pm.test('Status=Cancelled', () => pm.expect(pm.response.json().data.status).to.eql('Cancelled'));",
                                    "pm.test('Message', () => pm.expect(pm.response.json().message).to.include('cancelled'));"
                                ]
                            }
                        }
                    ]
                },
                {
                    "name": "6.2 Verify Stock Restored After Cancel",
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{baseUrl}}/api/products/{{productId2}}",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "products",
                                "{{productId2}}"
                            ]
                        }
                    },
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Stock restored - 200', () => pm.response.to.have.status(200));",
                                    "pm.test('Stock=50 (original)', () => pm.expect(pm.response.json().data.stockQuantity).to.eql(50));"
                                ]
                            }
                        }
                    ]
                },
                {
                    "name": "6.3 Cancel Non-Pending Order (400)",
                    "request": {
                        "method": "PUT",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{customerToken}}"
                            }
                        ],
                        "url": {
                            "raw": "{{baseUrl}}/api/orders/{{orderId}}/cancel",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "orders",
                                "{{orderId}}",
                                "cancel"
                            ]
                        }
                    },
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Cannot cancel Delivered - 400', () => pm.response.to.have.status(400));",
                                    "pm.test('Error msg', () => pm.expect(pm.response.json().message).to.include('Cannot cancel'));"
                                ]
                            }
                        }
                    ]
                }
            ]
        },
        {
            "name": "7. Reports (Admin)",
            "item": [
                {
                    "name": "7.1 Revenue Report",
                    "request": {
                        "method": "GET",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{adminToken}}"
                            }
                        ],
                        "url": {
                            "raw": "{{baseUrl}}/api/reports/revenue",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "reports",
                                "revenue"
                            ]
                        }
                    },
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Revenue - 200', () => pm.response.to.have.status(200));",
                                    "var d = pm.response.json().data;",
                                    "pm.test('Has totalRevenue', () => pm.expect(d.totalRevenue).to.be.a('number'));",
                                    "pm.test('Has monthlyRevenue', () => pm.expect(d.monthlyRevenue).to.be.an('array'));",
                                    "pm.test('Has completedOrders', () => pm.expect(d.completedOrders).to.be.a('number'));"
                                ]
                            }
                        }
                    ]
                },
                {
                    "name": "7.2 Best Selling Products",
                    "request": {
                        "method": "GET",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{adminToken}}"
                            }
                        ],
                        "url": {
                            "raw": "{{baseUrl}}/api/reports/best-selling?top=5",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "reports",
                                "best-selling"
                            ],
                            "query": [
                                {
                                    "key": "top",
                                    "value": "5"
                                }
                            ]
                        }
                    },
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Best Selling - 200', () => pm.response.to.have.status(200));",
                                    "pm.test('Is array', () => pm.expect(pm.response.json().data).to.be.an('array'));"
                                ]
                            }
                        }
                    ]
                },
                {
                    "name": "7.3 Dashboard",
                    "request": {
                        "method": "GET",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{adminToken}}"
                            }
                        ],
                        "url": {
                            "raw": "{{baseUrl}}/api/reports/dashboard",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "reports",
                                "dashboard"
                            ]
                        }
                    },
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Dashboard - 200', () => pm.response.to.have.status(200));",
                                    "var d = pm.response.json().data;",
                                    "pm.test('Has totalUsers', () => pm.expect(d.totalUsers).to.be.a('number'));",
                                    "pm.test('Has totalProducts', () => pm.expect(d.totalProducts).to.be.a('number'));",
                                    "pm.test('Has totalOrders', () => pm.expect(d.totalOrders).to.be.a('number'));",
                                    "pm.test('Has topProducts', () => pm.expect(d.topProducts).to.be.an('array'));",
                                    "pm.test('Has recentOrders', () => pm.expect(d.recentOrders).to.be.an('array'));"
                                ]
                            }
                        }
                    ]
                },
                {
                    "name": "7.4 Reports Without Auth (401)",
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{baseUrl}}/api/reports/dashboard",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "reports",
                                "dashboard"
                            ]
                        }
                    },
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('No Auth - 401', () => pm.response.to.have.status(401));"
                                ]
                            }
                        }
                    ]
                },
                {
                    "name": "7.5 Reports As Customer (403)",
                    "request": {
                        "method": "GET",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{customerToken}}"
                            }
                        ],
                        "url": {
                            "raw": "{{baseUrl}}/api/reports/dashboard",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "reports",
                                "dashboard"
                            ]
                        }
                    },
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Customer forbidden - 403', () => pm.response.to.have.status(403));"
                                ]
                            }
                        }
                    ]
                }
            ]
        },
        {
            "name": "8. Security Edge Cases",
            "item": [
                {
                    "name": "8.1 PageSize > 50 Rejected",
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{baseUrl}}/api/products?pageSize=999",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "products"
                            ],
                            "query": [
                                {
                                    "key": "pageSize",
                                    "value": "999"
                                }
                            ]
                        }
                    },
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('PageSize > 50 - 400', () => pm.response.to.have.status(400));"
                                ]
                            }
                        }
                    ]
                },
                {
                    "name": "8.2 Delete Product With Orders (400)",
                    "request": {
                        "method": "DELETE",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{adminToken}}"
                            }
                        ],
                        "url": {
                            "raw": "{{baseUrl}}/api/products/{{productId}}",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "products",
                                "{{productId}}"
                            ]
                        }
                    },
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Cannot delete - has orders - 400', () => pm.response.to.have.status(400));",
                                    "pm.test('Error msg', () => pm.expect(pm.response.json().message).to.include('order records'));"
                                ]
                            }
                        }
                    ]
                },
                {
                    "name": "8.3 Delete Category With Products (400)",
                    "request": {
                        "method": "DELETE",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{adminToken}}"
                            }
                        ],
                        "url": {
                            "raw": "{{baseUrl}}/api/categories/{{categoryId}}",
                            "host": [
                                "{{baseUrl}}"
                            ],
                            "path": [
                                "api",
                                "categories",
                                "{{categoryId}}"
                            ]
                        }
                    },
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Cannot delete - has products - 400', () => pm.response.to.have.status(400));"
                                ]
                            }
                        }
                    ]
                }
            ]
        }
    ]
}